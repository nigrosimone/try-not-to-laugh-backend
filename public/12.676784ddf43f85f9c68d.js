(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"1lbk":function(e,t,n){"use strict";n.r(t),n.d(t,"ExpressionTrainingModule",function(){return P});var i=n("ofXK"),a=n("tyNb"),o=n("lM/l"),c=n("fXoL"),r=n("tpjD"),s=n("eVtn");const d=["cameraDetection"];function h(e,t){if(1&e&&(c.Mb(0,"h1"),c.oc(1),c.Lb()),2&e){const e=c.Wb();c.zb(1),c.rc('Hai perso, dovevi fare una faccia "',e.targetExpression.label,'" invece ne hai fatta una "',e.loseExpression.label,'"!')}}function g(e,t){1&e&&(c.Mb(0,"h1"),c.oc(1,"Hai vinto!"),c.Lb())}function b(e,t){1&e&&(c.Mb(0,"h1"),c.oc(1,"Non riesco a vedere la tua faccia!"),c.Lb())}function l(e,t){if(1&e&&(c.Mb(0,"h1"),c.oc(1),c.Lb()),2&e){const e=c.Wb();c.zb(1),c.qc("Fai una faccia: ",e.targetExpression.label,"")}}function u(e,t){1&e&&(c.Mb(0,"h1"),c.oc(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),c.Lb())}function f(e,t){if(1&e&&(c.Mb(0,"span",10),c.oc(1),c.Lb()),2&e){const e=c.Wb(2);c.zb(1),c.qc("Record: ",e.recordDuration,"")}}function p(e,t){if(1&e&&(c.Mb(0,"div",7),c.Mb(1,"span",8),c.oc(2),c.Lb(),c.nc(3,f,2,1,"span",9),c.Lb()),2&e){const e=c.Wb();c.zb(1),c.kc("background",e.matchDuration>e.recordDuration?"green":"blue"),c.zb(1),c.qc("Espressioni: ",e.matchDuration,""),c.zb(1),c.cc("ngIf",e.recordDuration)}}const M=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],m=[{path:"",component:(()=>{class e{constructor(e,t,n){this.cdr=e,this.windowService=t,this.elRef=n,this.targetExpression=Object(o.a)(M),this.neutralRequested=!1,this.faceDetected=!1,this.faceMissingDetection=0,this.firstDetectionHappen=!1,this.detectionReady=!1,this.allReady=!1,this.endMatch=!1,this.loseMatch=!1,this.winMatch=!1,this.readyToGame=!1,this.width=0,this.height=0,this.recordDuration=0,this.matchDuration=0,this.recordDuration=this.getLocalStorageDuration()}ngOnInit(){this.subVwChanges=this.windowService.viewPortChanges.subscribe(()=>{this.doResize()})}ngOnDestroy(){Object(o.b)(this.subVwChanges)}onDetectionReady(e){this.detectionReady=!0,this.doThirdPartyOnReady()}doThirdPartyOnReady(){this.allReady=this.detectionReady,this.doResize()}onDetectionChanges(e){if(this.doResize(),e){this.firstDetectionHappen=!0,this.faceMissingDetection=0;let t=null,n=null;for(const i of M){const a=e[i.expression];i.expression===this.targetExpression.expression?a>.5&&(t=i):a>.8&&(n=i)}if(n)return this.loseExpression=n,void this.endGame(!1);t?(this.neutralRequested||(this.matchDuration++,this.matchDuration>this.recordDuration&&this.setLocalStorageDuration(this.matchDuration)),this.neutralRequested=!0):this.neutralRequested&&e.neutral>.5&&(this.targetExpression=Object(o.a)(M),this.neutralRequested=!1)}else this.firstDetectionHappen&&this.faceMissingDetection++;this.manageDetectionState()}manageDetectionState(){let e=this.faceMissingDetection<10;this.firstDetectionHappen||(e=!1),this.faceDetected!==e&&(this.faceDetected=e,this.manageReadyToGameState(),this.cdr.markForCheck())}endGame(e){this.endMatch||(this.winMatch=e,this.loseMatch=!this.winMatch,this.endMatch=!0,this.cameraDetection.pauseVideo(),window.navigator.vibrate(200),this.manageReadyToGameState(),this.cdr.markForCheck())}manageReadyToGameState(){const e=!this.endMatch&&this.faceDetected;this.readyToGame!==e&&(this.readyToGame=e,this.cdr.markForCheck())}doResize(){const e=this.elRef.nativeElement.clientWidth-1,t=this.elRef.nativeElement.clientHeight-1;e===this.width&&t===this.height||(this.width=e,this.height=t,this.cdr.markForCheck())}getLocalStorageDuration(){return+localStorage.getItem("expression-training-duration")}setLocalStorageDuration(e){localStorage.setItem("expression-training-duration",e.toString())}}return e.\u0275fac=function(t){return new(t||e)(c.Jb(c.h),c.Jb(r.a),c.Jb(c.l))},e.\u0275cmp=c.Db({type:e,selectors:[["app-expression-training"]],viewQuery:function(e,t){if(1&e&&c.sc(d,!0),2&e){let e;c.dc(e=c.Ub())&&(t.cameraDetection=e.first)}},decls:11,vars:14,consts:[[1,"game-container"],[1,"info"],[4,"ngIf"],["class","badge-container",4,"ngIf"],[1,"webcam"],[3,"width","height","drawDetection","detectionTimer","detectionReady","detectionChanges"],["cameraDetection",""],[1,"badge-container"],[1,"badge","badge-duration"],["class","badge badge-record-duration",4,"ngIf"],[1,"badge","badge-record-duration"]],template:function(e,t){1&e&&(c.Mb(0,"div",0),c.Mb(1,"div",1),c.nc(2,h,2,2,"h1",2),c.nc(3,g,2,0,"h1",2),c.nc(4,b,2,0,"h1",2),c.nc(5,l,2,1,"h1",2),c.nc(6,u,2,0,"h1",2),c.nc(7,p,4,4,"div",3),c.Lb(),c.Mb(8,"div",4),c.Mb(9,"app-camera-detection",5,6),c.Tb("detectionReady",function(e){return t.onDetectionReady(e)})("detectionChanges",function(e){return t.onDetectionChanges(e)}),c.Lb(),c.Lb(),c.Lb()),2&e&&(c.kc("width",t.width+"px")("height",t.height+"px"),c.zb(2),c.cc("ngIf",t.endMatch&&t.loseMatch),c.zb(1),c.cc("ngIf",t.endMatch&&t.winMatch),c.zb(1),c.cc("ngIf",t.detectionReady&&!t.endMatch&&!t.faceDetected),c.zb(1),c.cc("ngIf",t.faceDetected&&!t.endMatch&&!t.neutralRequested),c.zb(1),c.cc("ngIf",t.faceDetected&&!t.endMatch&&t.neutralRequested),c.zb(1),c.cc("ngIf",t.faceDetected||t.endMatch),c.zb(2),c.cc("width",t.width)("height",t.height)("drawDetection",!0)("detectionTimer",100))},directives:[i.k,s.a],styles:["[_nghost-%COMP%]{flex-direction:column}.game-container[_ngcontent-%COMP%], [_nghost-%COMP%]{display:flex;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{flex-direction:column;flex:1 1 auto;overflow:hidden}.game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:#ff0;color:#000}"]}),e})()}];let C=(()=>{class e{}return e.\u0275mod=c.Hb({type:e}),e.\u0275inj=c.Gb({factory:function(t){return new(t||e)},imports:[[a.b.forChild(m)],a.b]}),e})();var D=n("8Vwt"),O=n("v6By");let P=(()=>{class e{}return e.\u0275mod=c.Hb({type:e}),e.\u0275inj=c.Gb({factory:function(t){return new(t||e)},imports:[[i.c,C,D.a,O.a]]}),e})()}}]);