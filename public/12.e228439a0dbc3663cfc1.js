(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"1lbk":function(e,t,n){"use strict";n.r(t),n.d(t,"ExpressionTrainingModule",function(){return P});var i=n("ofXK"),o=n("tyNb"),a=n("lM/l"),c=n("fXoL"),r=n("tpjD"),s=n("eVtn");const d=["cameraDetection"];function h(e,t){if(1&e&&(c.Ob(0,"h1"),c.pc(1),c.Nb()),2&e){const e=c.Yb();c.Bb(1),c.sc('Hai perso, dovevi fare una faccia "',e.targetExpression.label,'" invece ne hai fatta una "',e.loseExpression.label,'"!')}}function g(e,t){1&e&&(c.Ob(0,"h1"),c.pc(1,"Hai vinto!"),c.Nb())}function b(e,t){1&e&&(c.Ob(0,"h1"),c.pc(1,"Non riesco a vedere la tua faccia!"),c.Nb())}function u(e,t){if(1&e&&(c.Ob(0,"h1"),c.pc(1),c.Nb()),2&e){const e=c.Yb();c.Bb(1),c.rc("Fai una faccia: ",e.targetExpression.label,"")}}function l(e,t){1&e&&(c.Ob(0,"h1"),c.pc(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),c.Nb())}function f(e,t){if(1&e&&(c.Ob(0,"span",10),c.pc(1),c.Nb()),2&e){const e=c.Yb(2);c.Bb(1),c.rc("Record: ",e.recordDuration,"")}}function p(e,t){if(1&e&&(c.Ob(0,"div",7),c.Ob(1,"span",8),c.pc(2),c.Nb(),c.oc(3,f,2,1,"span",9),c.Nb()),2&e){const e=c.Yb();c.Bb(1),c.lc("background",e.matchDuration>e.recordDuration?"green":"blue"),c.Bb(1),c.rc("Espressioni: ",e.matchDuration,""),c.Bb(1),c.ec("ngIf",e.recordDuration)}}const m=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],O=[{path:"",component:(()=>{class e{constructor(e,t,n){this.cdr=e,this.windowService=t,this.elRef=n,this.targetExpression=Object(a.b)(m),this.neutralRequested=!1,this.faceDetected=!1,this.firstDetectionHappen=!1,this.detectionReady=!1,this.allReady=!1,this.endMatch=!1,this.loseMatch=!1,this.winMatch=!1,this.readyToGame=!1,this.width=0,this.height=0,this.recordDuration=0,this.matchDuration=0,this.recordDuration=this.getLocalStorageDuration()}ngOnInit(){this.subVwChanges=this.windowService.viewPortChanges.subscribe(()=>{this.doResize()})}ngOnDestroy(){Object(a.c)(this.subVwChanges)}onDetectionReady(e){this.detectionReady=!0,this.doThirdPartyOnReady()}onFirstDetection(e){this.firstDetectionHappen=e}onDetectionFace(e){this.faceDetected=e}doThirdPartyOnReady(){this.allReady=this.detectionReady,this.doResize()}onDetectionChanges(e){if(this.doResize(),e){let t=null,n=null;for(const i of m){const o=e[i.expression];i.expression===this.targetExpression.expression?o>.4&&(t=i):o>.94&&(n=i)}if(n)return this.loseExpression=n,void this.endGame(!1);t?(this.neutralRequested||(Object(a.a)(),this.matchDuration++),this.neutralRequested=!0):this.neutralRequested&&e.neutral>.6&&(this.targetExpression=Object(a.b)(m),this.neutralRequested=!1)}this.manageReadyToGameState()}endGame(e){this.endMatch||(this.winMatch=e,this.loseMatch=!this.winMatch,this.endMatch=!0,this.cameraDetection.pauseVideo(),window.navigator.vibrate(200),this.manageReadyToGameState(),this.matchDuration>this.recordDuration&&this.setLocalStorageDuration(this.matchDuration),this.cdr.markForCheck())}manageReadyToGameState(){const e=!this.endMatch&&this.faceDetected;this.readyToGame!==e&&(this.readyToGame=e,this.cdr.markForCheck())}doResize(){const e=this.elRef.nativeElement.clientWidth-1,t=this.elRef.nativeElement.clientHeight-1;e===this.width&&t===this.height||(this.width=e,this.height=t,this.cdr.markForCheck())}getLocalStorageDuration(){return+localStorage.getItem("expression-training-duration")}setLocalStorageDuration(e){localStorage.setItem("expression-training-duration",e.toString())}}return e.\u0275fac=function(t){return new(t||e)(c.Lb(c.h),c.Lb(r.a),c.Lb(c.l))},e.\u0275cmp=c.Fb({type:e,selectors:[["app-expression-training"]],viewQuery:function(e,t){if(1&e&&c.tc(d,1),2&e){let e;c.fc(e=c.Wb())&&(t.cameraDetection=e.first)}},decls:11,vars:14,consts:[[1,"game-container"],[1,"info"],[4,"ngIf"],["class","badge-container",4,"ngIf"],[1,"webcam"],[3,"width","height","drawDetection","detectionTimer","detectionReady","detectionChanges","firstDetection","detectionFace"],["cameraDetection",""],[1,"badge-container"],[1,"badge","badge-duration"],["class","badge badge-record-duration",4,"ngIf"],[1,"badge","badge-record-duration"]],template:function(e,t){1&e&&(c.Ob(0,"div",0),c.Ob(1,"div",1),c.oc(2,h,2,2,"h1",2),c.oc(3,g,2,0,"h1",2),c.oc(4,b,2,0,"h1",2),c.oc(5,u,2,1,"h1",2),c.oc(6,l,2,0,"h1",2),c.oc(7,p,4,4,"div",3),c.Nb(),c.Ob(8,"div",4),c.Ob(9,"app-camera-detection",5,6),c.Vb("detectionReady",function(e){return t.onDetectionReady(e)})("detectionChanges",function(e){return t.onDetectionChanges(e)})("firstDetection",function(e){return t.onFirstDetection(e)})("detectionFace",function(e){return t.onDetectionFace(e)}),c.Nb(),c.Nb(),c.Nb()),2&e&&(c.lc("width",t.width+"px")("height",t.height+"px"),c.Bb(2),c.ec("ngIf",t.endMatch&&t.loseMatch),c.Bb(1),c.ec("ngIf",t.endMatch&&t.winMatch),c.Bb(1),c.ec("ngIf",t.detectionReady&&!t.endMatch&&!t.faceDetected),c.Bb(1),c.ec("ngIf",t.faceDetected&&!t.endMatch&&!t.neutralRequested),c.Bb(1),c.ec("ngIf",t.faceDetected&&!t.endMatch&&t.neutralRequested),c.Bb(1),c.ec("ngIf",t.faceDetected||t.endMatch),c.Bb(2),c.ec("width",t.width)("height",t.height)("drawDetection",!0)("detectionTimer",100))},directives:[i.k,s.a],styles:["[_nghost-%COMP%]{flex-direction:column}.game-container[_ngcontent-%COMP%], [_nghost-%COMP%]{display:flex;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{flex-direction:column;flex:1 1 auto;overflow:hidden}.game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:#ff0;color:#000}"]}),e})()}];let M=(()=>{class e{}return e.\u0275mod=c.Jb({type:e}),e.\u0275inj=c.Ib({factory:function(t){return new(t||e)},imports:[[o.b.forChild(O)],o.b]}),e})();var C=n("8Vwt"),D=n("v6By");let P=(()=>{class e{}return e.\u0275mod=c.Jb({type:e}),e.\u0275inj=c.Ib({factory:function(t){return new(t||e)},imports:[[i.c,M,C.a,D.a]]}),e})()}}]);